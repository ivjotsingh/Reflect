<!-- CBT Worksheet Modal -->
<div id="cbt-worksheet-modal" class="modal-overlay">
    <div class="cbt-modal">
        <div class="modal-header">
            <h2>Thought Challenge</h2>
            <button id="close-cbt-modal" class="close-modal-btn">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" stroke="currentColor"
                    stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <line x1="18" y1="6" x2="6" y2="18"></line>
                    <line x1="6" y1="6" x2="18" y2="18"></line>
                </svg>
            </button>
        </div>

        <div class="cbt-container">
            <!-- Progress Indicator -->
            <div class="cbt-progress-container">
                <div class="cbt-progress-steps">
                    <div class="cbt-step active" data-step="1">
                        <div class="step-number">1</div>
                        <div class="step-label">Situation</div>
                    </div>
                    <div class="cbt-step" data-step="2">
                        <div class="step-number">2</div>
                        <div class="step-label">Thoughts</div>
                    </div>
                    <div class="cbt-step" data-step="3">
                        <div class="step-number">3</div>
                        <div class="step-label">Emotions</div>
                    </div>
                    <div class="cbt-step" data-step="4">
                        <div class="step-number">4</div>
                        <div class="step-label">Patterns</div>
                    </div>
                    <div class="cbt-step" data-step="5">
                        <div class="step-number">5</div>
                        <div class="step-label">Evidence</div>
                    </div>
                    <div class="cbt-step" data-step="6">
                        <div class="step-number">6</div>
                        <div class="step-label">Alternatives</div>
                    </div>
                    <div class="cbt-step" data-step="7">
                        <div class="step-number">7</div>
                        <div class="step-label">Results</div>
                    </div>
                </div>
                <div class="cbt-progress-bar">
                    <div class="cbt-progress-fill"></div>
                </div>
            </div>

            <!-- Step 1: Situation Analysis -->
            <div class="cbt-step-content active" data-step="1">
                <div class="step-header">
                    <h3>Describe the Situation</h3>
                    <p class="step-description">What happened? When and where did it occur? Who was involved?</p>
                </div>

                <textarea class="cbt-textarea" id="situation-description" placeholder="Describe the situation that triggered your emotional response..."></textarea>

                <div class="cbt-info-box">
                    <div class="info-icon">
                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="#3498db" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <circle cx="12" cy="12" r="10"></circle>
                            <line x1="12" y1="16" x2="12" y2="12"></line>
                            <line x1="12" y1="8" x2="12.01" y2="8"></line>
                        </svg>
                    </div>
                    <p>Be specific about the facts. Focus on describing what happened objectively, without interpretations or judgments.</p>
                </div>
            </div>

            <!-- Step 2: Automatic Thoughts -->
            <div class="cbt-step-content" data-step="2">
                <div class="step-header">
                    <h3>Identify Your Thoughts</h3>
                    <p class="step-description">What thoughts went through your mind during or after the situation?</p>
                </div>

                <div class="thought-bubbles">
                    <div class="thought-bubble-container" id="thought-bubble-container">
                        <div class="thought-bubble">
                            <textarea class="thought-input" placeholder="I thought..."></textarea>
                            <div class="belief-slider-container">
                                <label>How strongly do you believe this thought? <span class="belief-value">50%</span></label>
                                <input type="range" min="0" max="100" value="50" class="belief-slider">
                            </div>
                        </div>
                    </div>
                    <button class="add-thought-btn" id="add-thought-btn">
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <line x1="12" y1="5" x2="12" y2="19"></line>
                            <line x1="5" y1="12" x2="19" y2="12"></line>
                        </svg>
                        Add Another Thought
                    </button>
                </div>

                <div class="cbt-info-box">
                    <div class="info-icon">
                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="#3498db" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <circle cx="12" cy="12" r="10"></circle>
                            <line x1="12" y1="16" x2="12" y2="12"></line>
                            <line x1="12" y1="8" x2="12.01" y2="8"></line>
                        </svg>
                    </div>
                    <p>Automatic thoughts are the immediate, unfiltered thoughts that pop into your mind. Don't censor yourself - write down all thoughts, even if they seem irrational.</p>
                </div>
            </div>

            <!-- Step 3: Emotions -->
            <div class="cbt-step-content" data-step="3">
                <div class="step-header">
                    <h3>Identify Your Emotions</h3>
                    <p class="step-description">What emotions did you feel during the situation? Rate their intensity.</p>
                </div>

                <div class="emotion-grid">
                    <div class="emotion-item">
                        <div class="emotion-icon">ðŸ˜Ÿ</div>
                        <div>Anxiety</div>
                        <input type="range" min="0" max="100" value="0" class="emotion-intensity" data-emotion="anxiety">
                        <div class="intensity-label">Not present</div>
                    </div>
                    <div class="emotion-item">
                        <div class="emotion-icon">ðŸ˜ </div>
                        <div>Anger</div>
                        <input type="range" min="0" max="100" value="0" class="emotion-intensity" data-emotion="anger">
                        <div class="intensity-label">Not present</div>
                    </div>
                    <div class="emotion-item">
                        <div class="emotion-icon">ðŸ˜ž</div>
                        <div>Sadness</div>
                        <input type="range" min="0" max="100" value="0" class="emotion-intensity" data-emotion="sadness">
                        <div class="intensity-label">Not present</div>
                    </div>
                    <div class="emotion-item">
                        <div class="emotion-icon">ðŸ˜³</div>
                        <div>Shame</div>
                        <input type="range" min="0" max="100" value="0" class="emotion-intensity" data-emotion="shame">
                        <div class="intensity-label">Not present</div>
                    </div>
                    <div class="emotion-item">
                        <div class="emotion-icon">ðŸ˜¨</div>
                        <div>Fear</div>
                        <input type="range" min="0" max="100" value="0" class="emotion-intensity" data-emotion="fear">
                        <div class="intensity-label">Not present</div>
                    </div>
                    <div class="emotion-item">
                        <div class="emotion-icon">ðŸ˜©</div>
                        <div>Guilt</div>
                        <input type="range" min="0" max="100" value="0" class="emotion-intensity" data-emotion="guilt">
                        <div class="intensity-label">Not present</div>
                    </div>
                </div>

                <div class="other-emotion-container">
                    <label>Other emotions you felt:</label>
                    <input type="text" id="other-emotions" placeholder="Type any other emotions separated by commas...">
                </div>
            </div>

            <!-- Step 4: Cognitive Distortions -->
            <div class="cbt-step-content" data-step="4">
                <div class="step-header">
                    <h3>Identify Thinking Patterns</h3>
                    <p class="step-description">Check any patterns of distorted thinking that might apply to your thoughts.</p>
                </div>

                <div class="distortion-container">
                    <label class="distortion-item">
                        <div class="distortion-checkbox-container">
                            <input type="checkbox" class="distortion-checkbox" value="all-or-nothing">
                            <span class="checkmark"></span>
                            <div class="distortion-label">
                                <span class="distortion-title">All-or-Nothing Thinking</span>
                                <span class="distortion-desc">Seeing things in black and white categories with no middle ground</span>
                            </div>
                        </div>
                    </label>
                    <label class="distortion-item">
                        <div class="distortion-checkbox-container">
                            <input type="checkbox" class="distortion-checkbox" value="overgeneralization">
                            <span class="checkmark"></span>
                            <div class="distortion-label">
                                <span class="distortion-title">Overgeneralization</span>
                                <span class="distortion-desc">Viewing a single negative event as a never-ending pattern of defeat</span>
                            </div>
                        </div>
                    </label>
                    <label class="distortion-item">
                        <div class="distortion-checkbox-container">
                            <input type="checkbox" class="distortion-checkbox" value="mental-filter">
                            <span class="checkmark"></span>
                            <div class="distortion-label">
                                <span class="distortion-title">Mental Filter</span>
                                <span class="distortion-desc">Focusing on a single negative detail and dwelling on it exclusively</span>
                            </div>
                        </div>
                    </label>
                    <label class="distortion-item">
                        <div class="distortion-checkbox-container">
                            <input type="checkbox" class="distortion-checkbox" value="discounting-positives">
                            <span class="checkmark"></span>
                            <div class="distortion-label">
                                <span class="distortion-title">Discounting the Positive</span>
                                <span class="distortion-desc">Rejecting positive experiences by insisting they "don't count"</span>
                            </div>
                        </div>
                    </label>
                    <label class="distortion-item">
                        <div class="distortion-checkbox-container">
                            <input type="checkbox" class="distortion-checkbox" value="jumping-to-conclusions">
                            <span class="checkmark"></span>
                            <div class="distortion-label">
                                <span class="distortion-title">Jumping to Conclusions</span>
                                <span class="distortion-desc">Making negative interpretations without supporting facts</span>
                            </div>
                        </div>
                    </label>
                    <label class="distortion-item">
                        <div class="distortion-checkbox-container">
                            <input type="checkbox" class="distortion-checkbox" value="catastrophizing">
                            <span class="checkmark"></span>
                            <div class="distortion-label">
                                <span class="distortion-title">Catastrophizing</span>
                                <span class="distortion-desc">Exaggerating the importance of problems or minimizing positive qualities</span>
                            </div>
                        </div>
                    </label>
                    <label class="distortion-item">
                        <div class="distortion-checkbox-container">
                            <input type="checkbox" class="distortion-checkbox" value="emotional-reasoning">
                            <span class="checkmark"></span>
                            <div class="distortion-label">
                                <span class="distortion-title">Emotional Reasoning</span>
                                <span class="distortion-desc">Assuming that negative emotions reflect the way things really are</span>
                            </div>
                        </div>
                    </label>
                    <label class="distortion-item">
                        <div class="distortion-checkbox-container">
                            <input type="checkbox" class="distortion-checkbox" value="should-statements">
                            <span class="checkmark"></span>
                            <div class="distortion-label">
                                <span class="distortion-title">Should Statements</span>
                                <span class="distortion-desc">Operating by rigid rules about how you and others "should" behave</span>
                            </div>
                        </div>
                    </label>
                    <label class="distortion-item">
                        <div class="distortion-checkbox-container">
                            <input type="checkbox" class="distortion-checkbox" value="labeling">
                            <span class="checkmark"></span>
                            <div class="distortion-label">
                                <span class="distortion-title">Labeling</span>
                                <span class="distortion-desc">Attaching negative labels to yourself or others instead of describing behavior</span>
                            </div>
                        </div>
                    </label>
                    <label class="distortion-item">
                        <div class="distortion-checkbox-container">
                            <input type="checkbox" class="distortion-checkbox" value="personalization">
                            <span class="checkmark"></span>
                            <div class="distortion-label">
                                <span class="distortion-title">Personalization</span>
                                <span class="distortion-desc">Seeing yourself as the cause of some negative event for which you weren't primarily responsible</span>
                            </div>
                        </div>
                    </label>
                </div>
            </div>

            <!-- Step 5: Evidence Examination -->
            <div class="cbt-step-content" data-step="5">
                <div class="step-header">
                    <h3>Examine the Evidence</h3>
                    <p class="step-description">List evidence that supports and contradicts your thought.</p>
                </div>

                <div class="thought-selector">
                    <label>Select a thought to examine:</label>
                    <select id="thought-to-examine">
                        <option value="">Select a thought...</option>
                    </select>
                </div>

                <div class="evidence-columns">
                    <div class="evidence-column">
                        <h4>Evidence For</h4>
                        <textarea class="cbt-textarea evidence-textarea" id="evidence-for" placeholder="What evidence supports this thought being true?"></textarea>
                    </div>
                    <div class="evidence-column">
                        <h4>Evidence Against</h4>
                        <textarea class="cbt-textarea evidence-textarea" id="evidence-against" placeholder="What evidence suggests this thought might not be true or is exaggerated?"></textarea>
                    </div>
                </div>

                <div class="cbt-info-box">
                    <div class="info-icon">
                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="#3498db" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <circle cx="12" cy="12" r="10"></circle>
                            <line x1="12" y1="16" x2="12" y2="12"></line>
                            <line x1="12" y1="8" x2="12.01" y2="8"></line>
                        </svg>
                    </div>
                    <p>Try to be objective and consider all the facts. Think like a detective gathering evidence without bias.</p>
                </div>
            </div>

            <!-- Step 6: Alternative Perspective -->
            <div class="cbt-step-content" data-step="6">
                <div class="step-header">
                    <h3>Develop Alternative Perspectives</h3>
                    <p class="step-description">Challenge your thoughts by considering different viewpoints.</p>
                </div>

                <div class="perspective-container">
                    <div class="perspective-prompts">
                        <div class="perspective-prompt">
                            <div class="prompt-question">How might someone else view this situation?</div>
                            <textarea class="perspective-input" id="other-perspective"></textarea>
                        </div>
                        <div class="perspective-prompt">
                            <div class="prompt-question">What advice would you give to a friend in this situation?</div>
                            <textarea class="perspective-input" id="friend-advice"></textarea>
                        </div>
                        <div class="perspective-prompt">
                            <div class="prompt-question">What's a more balanced or helpful way to think about this?</div>
                            <textarea class="perspective-input" id="balanced-view"></textarea>
                        </div>
                    </div>

                    <div class="balanced-thought-container">
                        <h4>Write a balanced thought</h4>
                        <textarea class="cbt-textarea" id="balanced-thought" placeholder="Based on the evidence and alternative perspectives, what's a more balanced way to think about this situation?"></textarea>

                        <div class="belief-slider-container">
                            <label>How strongly do you believe this balanced thought? <span class="balanced-belief-value">0%</span></label>
                            <input type="range" min="0" max="100" value="0" class="belief-slider" id="balanced-belief-slider">
                        </div>
                    </div>
                </div>
            </div>

            <!-- Step 7: Results & Learning -->
            <div class="cbt-step-content" data-step="7">
                <div class="step-header">
                    <h3>Results & Learning</h3>
                    <p class="step-description">Review how your thoughts and emotions have changed.</p>
                </div>

                <div class="results-container">
                    <div class="results-comparison">
                        <div class="result-column">
                            <h4>Original Thought</h4>
                            <div class="result-thought" id="result-original-thought">
                                <!-- Will be filled dynamically -->
                            </div>
                            <div class="result-belief">
                                <span>Belief:</span>
                                <div class="belief-meter">
                                    <div class="belief-fill original-belief-fill" id="original-belief-fill"></div>
                                    <div class="belief-percentage" id="original-belief-percentage">0%</div>
                                </div>
                            </div>
                        </div>
                        <div class="result-column">
                            <h4>Balanced Thought</h4>
                            <div class="result-thought" id="result-balanced-thought">
                                <!-- Will be filled dynamically -->
                            </div>
                            <div class="result-belief">
                                <span>Belief:</span>
                                <div class="belief-meter">
                                    <div class="belief-fill balanced-belief-fill" id="balanced-belief-fill"></div>
                                    <div class="belief-percentage" id="balanced-belief-percentage">0%</div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="emotion-changes">
                        <h4>Emotion Changes</h4>
                        <div class="emotion-comparison" id="emotion-comparison">
                            <!-- Will be filled dynamically -->
                        </div>
                        <div class="current-mood">
                            <p>How do you feel now?</p>
                            <input type="range" min="0" max="100" value="50" id="current-mood-slider">
                            <span id="current-mood-value">50%</span>
                        </div>
                    </div>

                    <div class="learning-reflection">
                        <h4>What I've Learned</h4>
                        <textarea class="cbt-textarea" id="learning-reflection" placeholder="What have you learned from this exercise? How might you apply this learning in the future?"></textarea>
                    </div>
                </div>
            </div>

            <!-- Navigation Controls -->
            <div class="cbt-navigation">
                <button class="cbt-nav-btn back" id="back-btn" style="display: none;">
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <line x1="19" y1="12" x2="5" y2="12"></line>
                        <polyline points="12 19 5 12 12 5"></polyline>
                    </svg>
                    Back
                </button>
                <button class="cbt-nav-btn save" id="save-btn">
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"></path>
                        <polyline points="17 21 17 13 7 13 7 21"></polyline>
                        <polyline points="7 3 7 8 15 8"></polyline>
                    </svg>
                    Save Progress
                </button>
                <button class="cbt-nav-btn next" id="next-btn">
                    Next
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <line x1="5" y1="12" x2="19" y2="12"></line>
                        <polyline points="12 5 19 12 12 19"></polyline>
                    </svg>
                </button>
            </div>
        </div>
    </div>
</div>
